$(document).ready(function(){var t=function(c){var a=[];for(var b in c)a.push(escape(b)+"="+escape(c[b]));if(a.length)return"?"+a.join("&")},n=function(c,a,b){$.extend(a,{method:"flickr."+c,api_key:"489c9667c5c8957340a78bacacb051d6",format:"json"});return $.ajax({url:"http://api.flickr.com/services/rest/",data:a,dataType:"jsonp",jsonp:"jsoncallback",success:b})},e,d,o=function(c,a,b){if(3*a<d&&2*b<e){b*=0.5*d/a;a=d*0.5}if(a>d){b*=d/a;a=d}if(b>e){a*=e/b;b=e}var g=$("#d").val();c={u:c,wd:a,ht:b,nh:Math.ceil(Math.pow(g*
a/b,0.5)),nv:Math.ceil(Math.pow(g*b/a,0.5))};c=$("<embed>").attr({src:"jigsawr/jigsaw.svg"+t(c),type:"image/svg+xml",width:d,height:e});$("#x").empty().append(c);$("body").addClass("j");$("#f").removeClass("l")};$("#f").submit(function(c){$(this).addClass("l");var a=$("#a a").height();d=$(document).width();e=$(document).height()-6*a;if($(this).hasClass("u")){var b=$("#u").val();a=$("<img>").attr("src",b);imElt=a.get(0);var g=false;a.load(function(){if(!g){o(b,imElt.width,imElt.height);g=true}});imElt.complete&&
a.trigger("load")}else{a={tags:$("#t").val().split().join(","),license:"1,2,4,5,7",sort:"interestingness-desc",content_type:1,media:"photos",per_page:25,extras:"owner_name"};n("photos.search",a,function(p){var h=p.photos.photo[Math.floor(Math.random()*p.photos.photo.length)];n("photos.getSizes",{photo_id:h.id},function(i){for(var q,l=0;l<i.sizes.size.length;++l){var f=i.sizes.size[l];if(f.width>d||f.height>e)break;q=f}f=q;i=$("<p>");$("<a>").attr("href","http://www.flickr.com/photos/"+h.owner+"/"+
h.id).text(h.title+" by "+h.ownername).appendTo(i);$("#c").empty().append(i);o(f.source,f.width,f.height)})})}c.preventDefault()});$("form a").click(function(){this.parentNode.parentNode.className=this.parentNode.id=="dt"?"u":"t"});if(location.search){var j={},r=location.search.substr(1).split("&");for(var k in r){var m=r[k],s=m.indexOf("=");j[unescape(m.slice(0,s))]=unescape(m.slice(s+1))}for(k in{d:1,u:1,t:1})$("#"+k).val(j[k]);if(j.u)$("#f").get(0).className="u";j.j&&$("#f").submit()}});
