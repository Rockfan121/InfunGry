window.Jigsaw=function(){var u=null,A=null,v=function(a){if(a.getAttribute)return a;return u.getElementById(a)},q=function(a,j,h){j=document.createElementNS("http://www.w3.org/2000/svg",j);if(h)for(var b in h)b=="href"?j.setAttributeNS("http://www.w3.org/1999/xlink","href",h[b]):j.setAttribute(b,h[b]);e=j;a.appendChild(e);return e},x=function(a,j){var h=0.4*a,b=0.5*0.1*a*(!!j^a<0?-1:1),f=b*(a<0!=b<0?-1:1);return["h"+0.5*(a-h),"q"+f+",0 "+f+","+b,"t"+-f+","+b,-f+","+b,f+0.5*h+","+b,f+0.5*h+","+-b,
-f+","+-b,-f+","+-b,f+","+-b,"h"+0.5*(a-h)]},y=function(a,j){var h=0.4*a,b=0.5*0.1*a*(!!j^a<0?-1:1),f=b*(a<0!=b<0?-1:1);return["v"+0.5*(a-h),"q0,"+f+" "+b+","+f,"t"+b+","+-f,b+","+-f,b+","+(f+0.5*h),-b+","+(f+0.5*h),-b+","+-f,-b+","+-f,-b+","+f,"v"+0.5*(a-h)]},t=function(a){a=a.getCTM();return{x:a.e,y:a.f}},C=function(a,j){a=v(a);var h=[];for(var b in j)h.push(j[b].hunk={i:b,elts:[j[b]]});var f=false,l=null,o=null,s=null;a.addEventListener("mousemove",function(k){if(f){var n=k.clientX-o;k=k.clientY-
s;for(var c in l.elts){var i=l.elts[c];i.setAttribute("transform","translate("+(i.startX+n)+","+(i.startY+k)+")")}}},false);a.addEventListener("mouseup",function(){if(f){for(var k=0;k<l.elts.length;++k){var n=l.elts[k],c=t(n);for(var i in n.adjs){var m=n.adjs[i];if(m.elt.hunk!=l){var g=t(m.elt);if(m.dx)g.x-=m.dx;if(m.dy)g.y-=m.dy;if(Math.pow(c.x-g.x,2)+Math.pow(c.y-g.y,2)<25){var B=g.x-c.x;c=g.y-c.y;for(var w in l.elts){g=l.elts[w];var z=t(g);g.setAttribute("transform","translate("+(z.x+B)+","+(z.y+
c)+")")}c=t(n);m=m.elt.hunk.elts;l.elts=l.elts.concat(m);for(w in m)m[w].hunk=l}}}}l=null;f=false}},false);for(var r in h){b=h[r];for(var p in b.elts)b.elts[p].addEventListener("mousedown",function(k){l=k.currentTarget.hunk;f=true;o=k.clientX;s=k.clientY;for(var n in l.elts){k=l.elts[n];var c=k.getCTM();k.startX=c.e;k.startY=c.f;k.parentNode.appendChild(k)}},false)}};return{init:function(a){u=a.target.ownerDocument;A=u.documentElement;a=location.search;var j={u:"http://farm5.static.flickr.com/4077/4871527376_35120786b3_z.jpg",
wd:640,ht:512,nh:8,nv:7};if(a){a=a.slice(1).split("&");for(var h in a){var b=a[h].indexOf("="),f=a[h].slice(0,b);b=unescape(a[h].slice(b+1));j[f]=b}}var l=j.u;a=j.wd;f=j.ht;h=j.nh;j=j.nv;b=a/h;var o=f/j,s=v("defs"),r=v("p"),p=r.ownerSVGElement,k;if(p.getBoundingClientRect){k=p.getBoundingClientRect();p=k.width;k=k.height}else{p=r.ownerSVGElement.width.animVal.value;k=r.ownerSVGElement.height.animVal.value}var n=q(s,"symbol",{id:"im"});q(n,"image",{href:l,width:a,height:f});l=[];n=[];for(var c=0;c<
h;++c){l[c]=[];for(var i=0;i<j;++i){var m=String.fromCharCode(97+c)+String.fromCharCode(97+i),g=["M0,0"];if(i==0)g.push("h"+b);else g=g.concat(x(b,(c*37^i*1009)%17&1));if(c==h-1)g.push("v"+o);else g=g.concat(y(o,((c+1)*37^i*1009)%17&2));if(i==j-1)g.push("h"+-b);else g=g.concat(0,x(-b,(c*37^(i+1)*1009)%17&1));if(c==0)g.push("v"+-o);else g=g.concat(0,y(-o,(c*37^i*1009)%17&2));g.push("z");d=g.join(" ");g=q(s,"pattern",{id:"p"+m,patternUnits:"userSpaceOnUse",patternContentUnits:"userSpaceOnUse",patternTransform:"translate("+
-c*b+","+-i*o+")",x:0,y:0,width:a,height:f});q(g,"use",{href:"#im"});g=q(r,"g",{id:"g"+m,transform:"translate("+Math.random()*(p-b)+","+Math.random()*(k-o)+")"});q(g,"path",{d:d,fill:"url(#p"+m+")"});l[c][i]=g;n.push(g)}}for(c=0;c<h;++c)for(i=0;i<j;++i){a=l[c][i].adjs=[];c>0&&a.push({elt:l[c-1][i],dx:-b});c+1<h&&a.push({elt:l[c+1][i],dx:b});i>0&&a.push({elt:l[c][i-1],dy:-o});i+1<j&&a.push({elt:l[c][i+1],dy:o})}C("p",n)}}}();
